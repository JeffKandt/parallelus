#!/usr/bin/env bash
set -euo pipefail

usage() {
  cat <<'HELP'
Usage: agents-rebase-continue [<git-args>...]

Continues the in-progress rebase with the repository guardrails enabled.
The helper forces a non-interactive editor (GIT_EDITOR=true) so Git does
not open $GIT_EDITOR, avoiding hangs in sandboxed shells.
HELP
}

if [[ ${1:-} == "-h" || ${1:-} == "--help" ]]; then
  usage
  exit 0
fi

repo_root=$(git rev-parse --show-toplevel 2>/dev/null || true)
if [[ -z "$repo_root" ]]; then
  echo "agents-rebase-continue: not inside a git repository" >&2
  exit 1
fi

cd "$repo_root"

if [[ ! -d .git/rebase-merge && ! -d .git/rebase-apply ]]; then
  echo "agents-rebase-continue: no rebase in progress" >&2
  exit 1
fi

# Force a non-interactive editor so rebases never invoke an interactive editor.
export GIT_EDITOR=true

exec git rebase --continue "$@"
